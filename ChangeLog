diff --git a/main.c b/main.c
index 4a74e2c..ecca63d 100644
--- a/main.c
+++ b/main.c
@@ -7,10 +7,14 @@
 #include <errno.h>
 #include <sys/types.h>
 #include <sys/wait.h>
+#include <dlfcn.h>
+#include <pthread.h>
 
 #include <readline/readline.h>
 #include <readline/history.h>
 
+#include "tsh_if.h"
+
 
 #define VERSION                                 \
     "tsh version 1.2.0\n"
@@ -26,6 +30,10 @@
 #define MAX_COMMAND_LENGTH 1024
 #define MAX_USER_LENGTH    128
 
+extern int inpipe[2];
+extern int outpipe[2];
+extern int read_from_stdin;
+
 static struct option longoptions [] = {
     {"version", 0, NULL, 'v'},
     {"help", 0, NULL, 'h'}
@@ -41,7 +49,38 @@ static void readopt(int argc, char *argv[]);
 static void execute(char *argv[]);
 static void cd(char *argv[]);
 
+void* start(void* args)
+{
+	int argc;
+	char* argv[2];
+    void *handle;
+    void *handle_core;	
+    int (*func_core)(int , char **);
+    char *error;
+/*******************************/
+   handle_core = dlopen("./libsimqt.so", RTLD_LAZY | RTLD_GLOBAL);
+	printf("1\n");
+   if(!handle_core){
+   fprintf(stderr, "%s\n", dlerror());
+        exit(EXIT_FAILURE);
+    }
+   
+    dlerror();    // Clear any existing error 
+     *(void **)(&func_core) = dlsym(handle_core , "simqt_main");
+	printf("2\n");
+
+    if ((error = dlerror()) != NULL)  {
+      fprintf(stderr, "%s\n", error);
+        exit(EXIT_FAILURE);
+    }
+
+   func_core(argc,argv);
+	return NULL;
+}
+
 int main(int argc, char *argv[]) {
+	pthread_t pthread_id;
+	pthread_create(&pthread_id, NULL, start, NULL);
     char *delimiter_position = NULL;
     char *command = NULL;
     int i = 0;
@@ -60,8 +99,15 @@ int main(int argc, char *argv[]) {
                 free(command);
                 command = NULL;
             }
-            
-            command = readline(PS1);
+
+//			if(read_from_stdin == 0) {
+//				command = readline(PS1);
+//			}else {
+				command = (char*)malloc(10000);
+				memset(command, 0, 10000);
+				read( inpipe[0] , command, 10000 );
+//			}
+			
             if ((command != NULL) && (*command != '\0')) {
                 add_history(command);
             }
=====================================================
commit e8ed85f166a7e562ef22739c4572a91b1a207af1
Author: Tyrion Lannister <Tyrion.Lannister.274AL@gmail.com>
Date:   Sun Sep 29 17:36:49 2013 +0800

    diff --git a/configure.ac b/configure.ac
    index 899e29f..16187bf 100644
    --- a/configure.ac
    +++ b/configure.ac
    @@ -13,8 +13,9 @@ AC_PROG_CC
     AC_PROG_INSTALL
    
     # Checks for libraries.
    -have_readline = no
    -AC_SEARCH_LIBS([readline add_history], [readline], [have_readline=yes])
    +have_readline=no
    +AC_SEARCH_LIBS([readline], [readline], [have_readline=yes])
    +AC_SEARCH_LIBS([add_history], [readline], [have_readline=yes])
    
     if test "x${have_readline} = xyes"; then
        AC_CHECK_HEADERS([readline/readline.h readline/history.h], [], [have_readline=no])

